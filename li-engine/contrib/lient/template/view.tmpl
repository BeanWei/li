{{/* gotype: entgo.io/ent/entc/gen.Type */}}

{{ define "model/additional/lient-view" }}
func List{{ $.Name }}View() view.Node {
	return node.List("{{ $.Package }}List").
		ForInit("@list{{ $.Name }}", List{{ $.Name }}Controller).
		DecoratorCard().
		Children(
			node.ListAction("{{ $.Package }}ListActions").Children(
				node.ListActionRecordEditDrawer("add{{ $.Name }}").
					Title("新建").
					ForSubmit("@add{{ $.Name }}", Create{{ $.Name }}Controller).
					ButtonType("primary").
					Children(
                        {{- range $f := $.Fields }}
                            {{- if $annotation := $f.Annotations.LiEnt }}
                                {{- if and $annotation.ViewSchema (not $annotation.DisableCreate) }}
                                    {{ $.Package }}.Node{{ $f.StructField }}(),
                                {{- end }}
                            {{- end }}
                        {{- end }}
					),
				node.ListActionRowSelection("deleteMany{{ $.Name }}").
					Title("删除").
					ForSubmit("@deleteMany{{ $.Name }}", DeleteMany{{ $.Name }}Controller).
					AfterReload().
					ConfirmTitle("确认删除").
					ButtonStatus("danger"),
			),
			node.ListTable("{{ $.Package }}ListTable").
				RowSelectionType("checkbox").
				Columns(
                    {{- range $i, $f := $.Fields }}
						{{- if not $f.Sensitive }}
                        {{- if $annotation := $f.Annotations.LiEnt }}
                            {{- if and $annotation.ViewSchema (not $annotation.DisableRead) $annotation.ColumnProps }}
								node.ListTableColumn("column{{ $i }}").
									Title({{ $.Package }}.Node{{ $f.StructField }}Title).
									DataIndex("{{ $f.Name }}").
									{{- if $annotation.ColumnProps.Align }}Align("{{ $annotation.ColumnProps.Align }}").{{- end }}
									{{- if $annotation.ColumnProps.Ellipsis }}Ellipsis().{{- end }}
									{{- if $annotation.ColumnProps.Width }}Width({{ $annotation.ColumnProps.Width }}){{- end }}
									Render({{ $.Package }}.Node{{ $f.StructField }}()),
                            {{- end }}
                        {{- end }}
						{{- end }}
                    {{- end }}
					node.ListTableColumn("column{{ len $.Fields }}").
						Title("操作").
						DataIndex("__action").
						Width(150).
						Render(
							node.Space("actions").Children(
								node.ListActionRecordEditDrawer("edit").
									Title("编辑").
									ForInit("@get{{ $.Name }}", Get{{ $.Name }}Controller).
									ForSubmit("@update{{ $.Name }}", Update{{ $.Name }}Controller).
									Children(
										{{- range $f := $.Fields }}
											{{- if $annotation := $f.Annotations.LiEnt }}
												{{- if and $annotation.ViewSchema (not $annotation.DisableUpdate) }}
													{{ $.Package }}.Node{{ $f.StructField }}(),
												{{- end }}
											{{- end }}
										{{- end }}
									),
								node.ListActionRecordDelete("delete").
									Title("删除").
									ForSubmit("@delete{{ $.Name }}", Delete{{ $.Name }}Controller),
							),
						),
				),
		)
}
{{ end }}